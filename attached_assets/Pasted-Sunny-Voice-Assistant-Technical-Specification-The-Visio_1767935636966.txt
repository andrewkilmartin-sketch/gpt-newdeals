Sunny Voice Assistant - Technical Specification
The Vision
A voice-first shopping experience that feels like talking to a helpful friend, not a robot. Natural conversation that converts to powerful search.

Architecture Overview
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      USER INTERFACE                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ  ‚îÇ   üé§    ‚îÇ  "School shoes for little girl"   ‚îÇ  Search ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ  Voice  ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Grid   ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ Button  ‚îÇ                                    ‚îÇ Results ‚îÇ     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    SUNNY VOICE ENGINE                            ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ OpenAI TTS   ‚îÇ  ‚îÇ OpenAI STT   ‚îÇ  ‚îÇ Conversation State   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ (Text to     ‚îÇ  ‚îÇ (Speech to   ‚îÇ  ‚îÇ Machine              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Speech)     ‚îÇ  ‚îÇ  Text)       ‚îÇ  ‚îÇ                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ ‚Ä¢ GREETING           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Voice:       ‚îÇ  ‚îÇ Whisper API  ‚îÇ  ‚îÇ ‚Ä¢ LISTENING          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ "shimmer"    ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ ‚Ä¢ CLARIFYING         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ or "nova"    ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ ‚Ä¢ SEARCHING          ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ ‚Ä¢ RESULTS_SHOWN      ‚îÇ  ‚îÇ
‚îÇ                                       ‚îÇ ‚Ä¢ FOLLOW_UP          ‚îÇ  ‚îÇ
‚îÇ                                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   INTENT PARSER (GPT-4)                          ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Input: "school shoes for little girl size 8 and good pizza"    ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Output: {                                                       ‚îÇ
‚îÇ    "searches": [                                                 ‚îÇ
‚îÇ      { "query": "school shoes girls size 8", "type": "product" }‚îÇ
‚îÇ      { "query": "pizza delivery", "type": "restaurant" }        ‚îÇ
‚îÇ    ],                                                            ‚îÇ
‚îÇ    "needsClarification": false,                                  ‚îÇ
‚îÇ    "clarifyingQuestion": null                                    ‚îÇ
‚îÇ  }                                                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

State Machine
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   IDLE      ‚îÇ
                    ‚îÇ (Button     ‚îÇ
                    ‚îÇ  visible)   ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ User clicks üé§
                           ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  GREETING   ‚îÇ ‚îÄ‚îÄ‚ñ∂ Sunny speaks intro
                    ‚îÇ             ‚îÇ     (1 of 20 variations)
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ Intro complete
                           ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  LISTENING  ‚îÇ ‚îÄ‚îÄ‚ñ∂ Microphone active
                    ‚îÇ             ‚îÇ     User speaks
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ Speech detected
                           ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  PARSING    ‚îÇ ‚îÄ‚îÄ‚ñ∂ GPT extracts intent
                    ‚îÇ             ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ                         ‚îÇ
              ‚ñº                         ‚ñº
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ CLARIFYING  ‚îÇ           ‚îÇ SEARCHING   ‚îÇ
     ‚îÇ             ‚îÇ           ‚îÇ             ‚îÇ
     ‚îÇ "What size?"‚îÇ           ‚îÇ Execute     ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ search(es)  ‚îÇ
            ‚îÇ                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ User responds          ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
                                     ‚ñº
                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                              ‚îÇRESULTS_SHOWN‚îÇ ‚îÄ‚îÄ‚ñ∂ Grid displays
                              ‚îÇ             ‚îÇ     Sunny fades
                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚îÇ User clicks üé§ again
                                     ‚ñº
                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                              ‚îÇ FOLLOW_UP   ‚îÇ ‚îÄ‚îÄ‚ñ∂ "What else can
                              ‚îÇ             ‚îÇ     I help with?"
                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     (1 of 20 variations)

Voice Lines Database
First-Time Greetings (20 variations)
javascriptconst FIRST_GREETINGS = [
  "Hi, I'm Sunny VS01. I'm here to help you search - just tell me exactly what you're looking for, and you can be as specific as you like.",
  "Hello! I'm Sunny, your shopping assistant. Tell me what you need - the more detail the better!",
  "Hey there! I'm Sunny. Looking for something specific? Just tell me - I can search over a million products for you.",
  "Hi! Sunny here. Whether it's shoes for the kids or a gift for grandma, just tell me what you need.",
  "Hello! I'm Sunny VS01. I search across hundreds of retailers to find exactly what you're looking for. What do you need today?",
  "Hi there! I'm Sunny. Tell me what you're shopping for - you can even say things like 'a gift for a 5 year old who loves dinosaurs under twenty pounds'.",
  "Hey! I'm Sunny, and I'm here to make shopping easier. What can I help you find?",
  "Hello! Sunny here. I can search for toys, clothes, shoes, restaurants, cinema - just tell me what you need.",
  "Hi! I'm Sunny VS01. Think of me as your personal shopping helper. What are we looking for today?",
  "Hey there! I'm Sunny. Just describe what you need, and I'll find it for you.",
  "Hello! I'm Sunny. Whether you need school shoes or birthday presents, I've got you covered. What do you need?",
  "Hi! Sunny here. I search across all the major retailers to find you the best options. What are you looking for?",
  "Hey! I'm Sunny VS01. Tell me what you need - I love a challenge!",
  "Hello there! I'm Sunny. From LEGO to Nike trainers, I can find it all. What do you need today?",
  "Hi! I'm Sunny, your family shopping assistant. What can I help you find?",
  "Hey! Sunny here. Just tell me what you're after - be as specific as you like.",
  "Hello! I'm Sunny VS01. Ready to help you find exactly what you need. What's on your list?",
  "Hi there! I'm Sunny. Shopping made simple - just tell me what you want.",
  "Hey! I'm Sunny. Looking for something? I search over a million products in seconds.",
  "Hello! Sunny here. Let's find what you're looking for. What do you need?"
];
Follow-Up Greetings (when results already showing)
javascriptconst FOLLOWUP_GREETINGS = [
  "What else can I help you with?",
  "Looking for something else?",
  "What else do you need?",
  "Anything else I can find for you?",
  "What's next on your list?",
  "Need help finding something else?",
  "What else can I search for?",
  "Ready when you are - what else do you need?",
  "I'm here - what else are you looking for?",
  "What other products can I find for you?",
  "Still here! What else do you need?",
  "Let me know what else you're after.",
  "Happy to help - what else?",
  "What's the next thing on your list?",
  "I can keep searching - what else do you need?",
  "Found those okay? What else can I get you?",
  "What else shall we look for?",
  "Ready for your next search - go ahead!",
  "What else would you like to find?",
  "I'm listening - what else do you need?"
];
Clarifying Questions
javascriptconst CLARIFICATIONS = {
  size_needed: [
    "No problem! What size were you looking for?",
    "Sure thing - what size do you need?",
    "Got it! And what size?",
    "Lovely - what size did you need?"
  ],
  age_needed: [
    "Great choice! What age is it for?",
    "Sure - what age are we looking at?",
    "No problem! How old is the little one?"
  ],
  budget_needed: [
    "Did you have a budget in mind?",
    "Any price range you're thinking of?",
    "How much were you looking to spend?"
  ],
  gender_needed: [
    "Is that for a boy or a girl?",
    "For a boy or girl?"
  ]
};
Transition to Results
javascriptconst SEARCH_TRANSITIONS = [
  "Perfect, let me find those for you.",
  "On it! Here's what I found.",
  "Great, searching now.",
  "Let me see what we've got.",
  "Got it - one moment.",
  "Sure thing, here we go.",
  "Searching for you now.",
  "Let's see what's available."
];
Error Handling
javascriptconst ERROR_RESPONSES = {
  inappropriate: [
    "I don't think we stock those! Anything else I can help with?",
    "Ha! That's not quite my area. What else do you need?",
    "We don't have those in the catalogue! What else can I find?"
  ],
  not_understood: [
    "Sorry, I didn't quite catch that. Could you try again?",
    "I missed that - could you say it once more?",
    "One more time? I want to make sure I get it right."
  ],
  off_topic: [
    "I'm just here to help you find products! What are you shopping for?",
    "I'm best at finding things to buy - what do you need?",
    "Let's stick to shopping - what can I find for you?"
  ],
  no_results: [
    "I couldn't find exactly that, but here are some similar options.",
    "Nothing exact, but these might work for you.",
    "Let me show you what's close to that."
  ]
};

Intent Parser Prompt
javascriptconst INTENT_PARSER_PROMPT = `You are Sunny's intent parser. Extract shopping intent from natural speech.

RULES:
1. Extract ONE or MORE searches from the input
2. Identify if clarification is needed (size, age, budget, gender)
3. Normalise UK English (mum, colour, trainers, etc.)
4. Handle multi-intent: "shoes and pizza" = 2 searches
5. Flag inappropriate requests

INPUT: User's spoken words
OUTPUT: JSON only

EXAMPLES:

Input: "school shoes for a little girl"
Output: {
  "searches": [{"query": "school shoes girls", "type": "product"}],
  "needsClarification": true,
  "clarifyField": "size",
  "clarifyingQuestion": "What size were you looking for?"
}

Input: "size 8"
Context: Previous was "school shoes girls"
Output: {
  "searches": [{"query": "school shoes girls size 8", "type": "product"}],
  "needsClarification": false
}

Input: "Nike trainers for my son he's 7 and some pizza places near me"
Output: {
  "searches": [
    {"query": "Nike trainers boys age 7", "type": "product"},
    {"query": "pizza restaurants", "type": "restaurant"}
  ],
  "needsClarification": false
}

Input: "something rude or inappropriate"
Output: {
  "searches": [],
  "isInappropriate": true,
  "needsClarification": false
}

Input: "what's the weather"
Output: {
  "searches": [],
  "isOffTopic": true,
  "needsClarification": false
}

Now parse this input:`;

Frontend Component
jsx// SunnyVoice.jsx
import { useState, useRef, useEffect } from 'react';

const SunnyVoice = ({ onSearch, hasResults }) => {
  const [state, setState] = useState('IDLE'); // IDLE, GREETING, LISTENING, CLARIFYING, SEARCHING
  const [conversationContext, setConversationContext] = useState([]);
  const [isFirstInteraction, setIsFirstInteraction] = useState(true);
  const audioRef = useRef(null);
  const mediaRecorderRef = useRef(null);

  // Pick random greeting
  const getGreeting = () => {
    if (isFirstInteraction) {
      return FIRST_GREETINGS[Math.floor(Math.random() * FIRST_GREETINGS.length)];
    }
    return FOLLOWUP_GREETINGS[Math.floor(Math.random() * FOLLOWUP_GREETINGS.length)];
  };

  // Text to Speech via OpenAI
  const speak = async (text) => {
    const response = await fetch('/api/tts', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        text, 
        voice: 'shimmer' // English female, soft
      })
    });
    const audioBlob = await response.blob();
    const audioUrl = URL.createObjectURL(audioBlob);
    audioRef.current.src = audioUrl;
    await audioRef.current.play();
  };

  // Speech to Text via OpenAI Whisper
  const transcribe = async (audioBlob) => {
    const formData = new FormData();
    formData.append('audio', audioBlob);
    const response = await fetch('/api/stt', {
      method: 'POST',
      body: formData
    });
    const { text } = await response.json();
    return text;
  };

  // Parse intent via GPT
  const parseIntent = async (text) => {
    const response = await fetch('/api/parse-intent', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        text, 
        context: conversationContext 
      })
    });
    return response.json();
  };

  // Main flow when mic button clicked
  const handleMicClick = async () => {
    if (state !== 'IDLE') return;

    // 1. Greeting
    setState('GREETING');
    const greeting = getGreeting();
    await speak(greeting);
    setIsFirstInteraction(false);

    // 2. Listen
    setState('LISTENING');
    const audioBlob = await recordAudio();
    
    // 3. Transcribe
    const userText = await transcribe(audioBlob);
    setConversationContext(prev => [...prev, { role: 'user', content: userText }]);

    // 4. Parse
    const intent = await parseIntent(userText);

    // 5. Handle result
    if (intent.isInappropriate) {
      await speak(ERROR_RESPONSES.inappropriate[0]);
      setState('IDLE');
      return;
    }

    if (intent.isOffTopic) {
      await speak(ERROR_RESPONSES.off_topic[0]);
      setState('IDLE');
      return;
    }

    if (intent.needsClarification) {
      setState('CLARIFYING');
      await speak(intent.clarifyingQuestion || CLARIFICATIONS[intent.clarifyField][0]);
      // Listen again for clarification
      const clarifyAudio = await recordAudio();
      const clarifyText = await transcribe(clarifyAudio);
      // Re-parse with context
      const finalIntent = await parseIntent(clarifyText);
      intent.searches = finalIntent.searches;
    }

    // 6. Execute search(es)
    setState('SEARCHING');
    const transition = SEARCH_TRANSITIONS[Math.floor(Math.random() * SEARCH_TRANSITIONS.length)];
    await speak(transition);

    // 7. Trigger search(es) - could be multiple!
    for (const search of intent.searches) {
      onSearch(search.query, search.type);
    }

    setState('IDLE');
  };

  // Record audio from microphone
  const recordAudio = () => {
    return new Promise((resolve) => {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
          const mediaRecorder = new MediaRecorder(stream);
          const chunks = [];
          
          mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
          mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { type: 'audio/webm' });
            stream.getTracks().forEach(track => track.stop());
            resolve(blob);
          };

          mediaRecorder.start();
          
          // Stop after silence or 10 seconds max
          setTimeout(() => mediaRecorder.stop(), 10000);
        });
    });
  };

  return (
    <>
      <audio ref={audioRef} />
      <button 
        onClick={handleMicClick}
        disabled={state !== 'IDLE'}
        className={`mic-button ${state}`}
      >
        {state === 'LISTENING' ? 'üî¥' : 'üé§'}
      </button>
      {state === 'LISTENING' && (
        <div className="listening-indicator">Listening...</div>
      )}
    </>
  );
};

Backend Endpoints
javascript// /api/tts - Text to Speech
app.post('/api/tts', async (req, res) => {
  const { text, voice = 'shimmer' } = req.body;
  
  const response = await openai.audio.speech.create({
    model: 'tts-1',
    voice: voice, // 'shimmer' = soft English female
    input: text,
    response_format: 'mp3'
  });
  
  const buffer = Buffer.from(await response.arrayBuffer());
  res.set('Content-Type', 'audio/mpeg');
  res.send(buffer);
});

// /api/stt - Speech to Text
app.post('/api/stt', upload.single('audio'), async (req, res) => {
  const transcription = await openai.audio.transcriptions.create({
    file: req.file,
    model: 'whisper-1',
    language: 'en'
  });
  
  res.json({ text: transcription.text });
});

// /api/parse-intent - Intent extraction
app.post('/api/parse-intent', async (req, res) => {
  const { text, context } = req.body;
  
  const response = await openai.chat.completions.create({
    model: 'gpt-4o-mini',
    messages: [
      { role: 'system', content: INTENT_PARSER_PROMPT },
      ...context,
      { role: 'user', content: text }
    ],
    response_format: { type: 'json_object' }
  });
  
  res.json(JSON.parse(response.choices[0].message.content));
});

Multi-Search Results Display
jsx// When Sunny returns multiple search types
const MultiSearchResults = ({ searches }) => {
  // searches = [
  //   { query: "school shoes girls size 8", type: "product", results: [...] },
  //   { query: "pizza delivery", type: "restaurant", results: [...] }
  // ]
  
  if (searches.length === 1) {
    // Normal full-width grid
    return <ProductGrid results={searches[0].results} />;
  }
  
  // Split view for multi-search
  return (
    <div className="multi-search-container">
      {searches.map((search, i) => (
        <div key={i} className="search-section" style={{ width: `${100/searches.length}%` }}>
          <h3>{search.type === 'product' ? 'üõçÔ∏è' : 'üçï'} {search.query}</h3>
          <ProductGrid results={search.results} compact />
        </div>
      ))}
    </div>
  );
};

OpenAI Voice Options
VoiceDescriptionBest ForshimmerSoft, warm female‚úÖ Recommended for SunnynovaFriendly femaleAlternativealloyNeutralNot idealechoMaleNofableBritish maleNoonyxDeep maleNo
Recommendation: Use shimmer - it's soft, friendly, and sounds natural.

Cost Estimate
APICostPer InteractionTTS (text-to-speech)$0.015 / 1K chars~$0.001 per greetingSTT (whisper)$0.006 / minute~$0.001 per 10 secondsGPT-4o-mini (parsing)$0.00015 / 1K tokens~$0.0001 per parseTotal per voice interaction~$0.003 (0.3p)
At 10,000 voice interactions/day = ~$30/day = ~$900/month

Implementation Priority
PhaseFeatureEffort1Basic voice button + TTS greeting2 hours2STT listening + transcription2 hours3Intent parsing + single search3 hours4Clarification flow2 hours5Multi-search support3 hours620 greeting variations1 hour7Error handling (inappropriate, off-topic)2 hours8Polish + animations2 hours
Total: ~2-3 days development

Tell Replit
Copy this entire spec and send to Replit:
"Build the Sunny Voice Assistant according to this specification. Start with Phase 1-3 (basic voice flow), then add clarification and multi-search.
Key requirements:

Use OpenAI TTS with 'shimmer' voice
Use Whisper for speech-to-text
Use GPT-4o-mini for intent parsing
20 random greetings for variety
Multi-search support (shoes AND pizza = split results)
Graceful handling of inappropriate/off-topic requests

Start with the backend endpoints (/api/tts, /api/stt, /api/parse-intent) then build the frontend component."

This is genuinely innovative. Voice-first shopping with natural conversation, multi-intent support, and personality. I haven't seen this done well anywhere else.