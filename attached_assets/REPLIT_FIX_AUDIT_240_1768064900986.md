# REPLIT FIX INSTRUCTIONS - AUDIT 240 QUERIES
## Read ALL instruction files first!

---

## âš ï¸ BEFORE YOU START - MANDATORY READING

**Read these files and tell me what's in each one:**

1. **CRITICAL_FIXES.md** - List the 12 fixes logged
2. **REPLIT_FIX_INSTRUCTIONS.md** - Confirm you understand the rules
3. **STOP_BLAMING_INVENTORY.md** - We have 1.5M products. No inventory excuses without SQL proof.

**Run regression tests and report pass/fail count.**

---

## AUDIT RESULTS SUMMARY (240 Queries)

| Verdict | Count | % |
|---------|-------|---|
| PASS | 213 | 89% |
| INVENTORY_GAP | 15 | 6% |
| RANKING_BUG | 6 | 2.5% |
| SEARCH_BUG | 3 | 1.3% |
| SPEED_BUG | 3 | 1.3% |

---

## BUGS TO FIX

### ðŸ”´ BUG: "lol dolls" STILL returning Ice Lolly Mug

**Query:** lol dolls
**Expected:** LOL Surprise dolls
**Got:** Summer On A Stick Ice Lolly Enamel Mug

**This was supposed to be fixed by word boundary matching.** Why is "lol" still matching "lolly"?

**Debug steps:**
1. Check if word boundary regex is being applied to this query
2. Check if "lol" is being expanded to other terms that match "lolly"
3. The searchTerms might be ["lol", "dolls"] but "lol" is matching "lolly" substring

**Fix required:** Ensure "lol" only matches "lol" as a whole word, NOT "lolly"

**Test:** "lol dolls" â†’ LOL Surprise products, NOT lolly/ice lolly products

---

### ðŸ”´ BUG: "hot wheels cars" returning wooden lorry

**Query:** hot wheels cars
**Expected:** Hot Wheels die-cast cars
**Got:** Personalised Transporter Lorry Wooden Toy

**Root cause:** "Hot Wheels" is a brand. Search should prioritise exact brand match.

**Debug:**
```sql
SELECT name, brand FROM products WHERE name ILIKE '%hot wheels%' LIMIT 10;
```

If Hot Wheels products exist, your brand matching is broken.

**Test:** "hot wheels cars" â†’ Hot Wheels branded products

---

### ðŸ”´ BUG: "thomas the tank engine" returning nothing

**Query:** thomas the tank engine
**Expected:** Thomas & Friends toys
**Got:** Nothing (SEARCH_BUG)

**Debug:**
```sql
SELECT name FROM products WHERE name ILIKE '%thomas%' LIMIT 20;
```

**Root cause likely:** "the tank engine" is confusing the search. Thomas products might be labelled "Thomas & Friends" not "Thomas the Tank Engine".

**Fix:** Add synonym mapping: "thomas the tank engine" â†’ ["thomas", "thomas & friends", "thomas and friends"]

**Test:** "thomas the tank engine" â†’ Thomas train products

---

### ðŸ”´ BUG: "calico critters" returning Wild Life Raccoon

**Query:** calico critters
**Expected:** Calico Critters toys (same as Sylvanian Families in UK)
**Got:** 14828 Wild Life Raccoon Figure

**Note:** "Calico Critters" is the US name for Sylvanian Families. 

**Debug:**
```sql
SELECT name FROM products WHERE name ILIKE '%sylvanian%' LIMIT 10;
```

If Sylvanian exists, add synonym: "calico critters" â†’ "sylvanian families"

**Test:** "calico critters" â†’ Sylvanian Families products (or nothing if truly no inventory)

---

### ðŸŸ¡ BUG: "stocking fillers under 5 pounds" returning wine accessory

**Query:** stocking fillers under 5 pounds
**Expected:** Kids stocking fillers under Â£5
**Got:** Wine Convo Generator

**Root cause:** Price filter may be working but relevance scoring is wrong - adult product returned for family platform.

**Fix:** Add "kids" or "children" context to stocking filler queries on a family platform.

---

### ðŸŸ¡ BUG: 3 Speed bugs (>10 seconds)

| Query | Time |
|-------|------|
| peppa pig school | 10,868ms |
| thomas train set | 10,465ms |
| dump truck toy | 10,666ms |

**Investigate:** Why are these specific queries slow? Check for:
- Missing indexes
- Complex joins
- Timeout issues

---

## CONFIRMED INVENTORY GAPS (Don't try to fix with code)

These brands genuinely don't exist in database:
- Roblox
- Sylvanian Families  
- Nerf
- Matchbox

**Action:** Need to add via Awin/CJ product feed - NOT a code fix.

---

## PREVIOUSLY FIXED - VERIFY STILL WORKING

| Query | Expected | Status in Audit |
|-------|----------|-----------------|
| toys for teenager | Age-appropriate | âœ… PASS |
| gifts for 8 year old boy | Kid gifts, not makeup | âœ… PASS |
| dinosaur figures | Figures, not clothing | âœ… PASS |

---

## AFTER EACH FIX

**Update CRITICAL_FIXES.md with:**
- Fix number (#13, #14, etc.)
- Date
- Problem
- Root cause (NOT "inventory gap" unless you proved it with SQL)
- Solution
- File and line numbers
- Test query

**Run regression tests. Don't commit if tests fail.**

---

## FIX PRIORITY ORDER

1. **"lol dolls" â†’ lolly bug** (word boundary not working)
2. **"thomas the tank engine" â†’ nothing** (synonym needed)
3. **"hot wheels cars" â†’ wrong product** (brand matching)
4. **Speed bugs** (investigate timeouts)

---

## SUMMARY

Total: 240 queries tested
- 89% PASS âœ…
- 6 ranking bugs to fix
- 3 search bugs to fix
- 3 speed bugs to investigate
- 15 genuine inventory gaps (Nerf, Roblox, etc.)

Previous fixes are holding. Focus on the word boundary bug (lol/lolly) first.
